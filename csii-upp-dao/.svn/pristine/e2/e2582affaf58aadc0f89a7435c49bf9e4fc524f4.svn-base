<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="OVERALLTRANSHISTEXTEND">
	<resultMap id="OveralltranshistextendMap" class="com.csii.upp.dto.generate.Overalltranshist">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<result column="OVERALLTRANSNBR" property="overalltransnbr" jdbcType="VARCHAR" />
		<result column="OVERALLTRANSTYPCD" property="overalltranstypcd" jdbcType="VARCHAR" />
		<result column="TRANSDATE" property="transdate" jdbcType="DATE" />
		<result column="TRANSTIME" property="transtime" jdbcType="TIMESTAMP" />
		<result column="OVERALLTRANSSTATUS" property="overalltransstatus" jdbcType="VARCHAR" />
		<result column="MEMO" property="memo" jdbcType="VARCHAR" />
		<result column="UPPERTRANSNBR" property="uppertransnbr" jdbcType="VARCHAR" />
		<result column="UPPERTRANSDATE" property="uppertransdate" jdbcType="DATE" />
		<result column="UPPERTRANSTIME" property="uppertranstime" jdbcType="TIMESTAMP" />
		<result column="UPPERSYSNBR" property="uppersysnbr" jdbcType="VARCHAR" />
		<result column="RETURNCODE" property="returncode" jdbcType="VARCHAR" />
		<result column="RETURNMSG" property="returnmsg" jdbcType="VARCHAR" />
		<result column="DATELASTMAINT" property="datelastmaint" jdbcType="TIMESTAMP" />
		<result column="ORIGOVERALLTRANSNBR" property="origoveralltransnbr" jdbcType="VARCHAR" />
		<result column="CHECKSTATUS" property="checkstatus" jdbcType="VARCHAR" />
		<result column="PAYERACCTNBR" property="payeracctnbr" jdbcType="VARCHAR" />
		<result column="PAYERACCTNAME" property="payeracctname" jdbcType="VARCHAR" />
		<result column="PAYEEACCTNBR" property="payeeacctnbr" jdbcType="VARCHAR" />
		<result column="PAYEEACCTNAME" property="payeeacctname" jdbcType="VARCHAR" />
		<result column="TRANSAMT" property="transamt" jdbcType="DECIMAL" />
		<result column="CURRENCYCD" property="currencycd" jdbcType="VARCHAR" />
	</resultMap>
	<insert id="insertOveralltranshistToAll" parameterClass="java.util.Date">
		insert into OVERALLTRANSHISTALL (OVERALLTRANSNBR, OVERALLTRANSTYPCD,
		TRANSDATE, TRANSTIME,
		OVERALLTRANSSTATUS, MEMO, UPPERTRANSNBR, UPPERTRANSDATE, UPPERTRANSTIME,
		UPPERSYSNBR, RETURNCODE, RETURNMSG, DATELASTMAINT, ORIGOVERALLTRANSNBR,
		CHECKSTATUS, PAYERACCTNBR, PAYERACCTNAME, PAYEEACCTNBR, PAYEEACCTNAME,
		TRANSAMT, CURRENCYCD, CHECKDATAFLAG, PAYEEACCTLIST)
		select OVERALLTRANSNBR, OVERALLTRANSTYPCD, TRANSDATE, TRANSTIME,
		OVERALLTRANSSTATUS, MEMO, UPPERTRANSNBR, UPPERTRANSDATE,
		UPPERTRANSTIME,
		UPPERSYSNBR, RETURNCODE, RETURNMSG, DATELASTMAINT, ORIGOVERALLTRANSNBR,
		CHECKSTATUS, PAYERACCTNBR, PAYERACCTNAME, PAYEEACCTNBR, PAYEEACCTNAME,
		TRANSAMT, CURRENCYCD, CHECKDATAFLAG, PAYEEACCTLIST
		from OVERALLTRANSHIST
     <![CDATA[
     where transdate < #transDate# and checkstatus <> '2'
     ]]>
	</insert>

	<select id="getOveralltranshistList" parameterClass="java.util.HashMap" resultMap="OveralltranshistextendMap">
	 <![CDATA[
		select distinct b.OVERALLTRANSNBR,b.OVERALLTRANSTYPCD,b.TRANSDATE,
		b.TRANSTIME,b.OVERALLTRANSSTATUS,b.MEMO,b.UPPERTRANSNBR,
		b.UPPERTRANSDATE,b.UPPERTRANSTIME,b.UPPERSYSNBR,b.RETURNCODE,
		b.RETURNMSG,b.DATELASTMAINT,b.ORIGOVERALLTRANSNBR,b.CHECKSTATUS,
		b.PAYERACCTNBR,b.PAYERACCTNAME,b.PAYEEACCTNBR,b.PAYEEACCTNAME,
		b.TRANSAMT,b.CURRENCYCD,b.CHECKDATAFLAG,b.PAYEEACCTLIST from fundchannel a,
		overalltranshist b, fundchannelcleartrans c  where a.fundchannelcode = c.fundchannelcode 
		and a.fundchanneltype = #fundchanneltype# and b.overalltransnbr=c.overalltransnbr 
		and c.transcode not in ('UnionPayCancelTrans', 'UnionPayInnerRefoundTrans')
	]]>	
		<isEqual property="checkdataflag" compareValue="UNIONPAY">
			and (b.checkdataflag ='UNIONPAY' or b.checkdataflag='ALIPAY' or b.checkdataflag='WXZF') 
		</isEqual>
		<isEqual property="checkdataflag" compareValue="CORE">
			and b.checkdataflag = #checkdataflag# 	  	
		</isEqual>		
		
	</select>
</sqlMap>