<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ONLINESUBTRANSHISTEXTEND">
	<insert id="insertOnlinesubtranshistToAll"  parameterClass="java.util.HashMap">
	INSERT INTO ONLINESUBTRANSHISTALL
	(SUBTRANSSEQNBR, TRANSSEQNBR, DOWNSYSSEQNBR, CLEARDATE, TRANSDATE, MERTRANSDATE, MERTRANSDATETIME, ORIGSUBMERSEQNBR, 
	ORIGSUBMERTRANSDATE, ORIGSUBTRANSSEQNBR, ORIGCLEARDATE, TRANSCODE, MERNBR, MEROPENDEPTNBR, 
	MERDEVDEPTNBR, PAYERACCTKIND, PAYEEACCTKIND, PAYERCARDTYPCD, PAYEECARDTYPCD, CUSTCIFNBR, PAYERACCTNBR, PAYERACCTTYPCD,
	PAYERACCTDEPTNBR, PAYERACCTNAME, PAYEEACCTNBR, PAYEEACCTDEPTNBR, PAYEEACCTTYPCD, PAYEEACCTNAME, TRANSAMT, CURRENCYCD, 
	REFUNDEDAMT, UNREFUNDAMT, TRANSAMT1, TRANSAMT2, FEEAMT, TRANSSTATUS, PROCSTEP, PROCSTATUS, MEMO1, TRANSTIME, MEMO2, 
	DEPARTMENTNBR, SYSTEMCODE, TRANSMODE, TRANSTYPCD, PROFITSEQNBR, CONFIRMEDPAYAMT, CONFIRMEDPAYDATE, CONFIRMEDCLEARDATE, 
	CONFIRMEDMERSEQNBR, CONFIRMEDMERDATETIME, REFUNDMODE, MERSEQNBR, PAYTYPCD, FEENBR, SUPFEENBR, ELECPORTFLAG,DATELASTMAINT) 
	SELECT SUBTRANSSEQNBR, TRANSSEQNBR, DOWNSYSSEQNBR, CLEARDATE, TRANSDATE, MERTRANSDATE, MERTRANSDATETIME, ORIGSUBMERSEQNBR,
	ORIGSUBMERTRANSDATE, ORIGSUBTRANSSEQNBR, ORIGCLEARDATE, TRANSCODE, MERNBR, MEROPENDEPTNBR, MERDEVDEPTNBR, PAYERACCTKIND, 
	PAYEEACCTKIND, PAYERCARDTYPCD, PAYEECARDTYPCD, CUSTCIFNBR, PAYERACCTNBR, PAYERACCTTYPCD, PAYERACCTDEPTNBR, PAYERACCTNAME, 
	PAYEEACCTNBR, PAYEEACCTDEPTNBR, PAYEEACCTTYPCD, PAYEEACCTNAME, TRANSAMT, CURRENCYCD, REFUNDEDAMT, UNREFUNDAMT, TRANSAMT1,
	TRANSAMT2, FEEAMT, TRANSSTATUS, PROCSTEP, PROCSTATUS, MEMO1, TRANSTIME, MEMO2, DEPARTMENTNBR, SYSTEMCODE, TRANSMODE, TRANSTYPCD, 
	PROFITSEQNBR, CONFIRMEDPAYAMT, CONFIRMEDPAYDATE, CONFIRMEDCLEARDATE, CONFIRMEDMERSEQNBR, CONFIRMEDMERDATETIME, REFUNDMODE, 
	MERSEQNBR, PAYTYPCD, FEENBR, SUPFEENBR, ELECPORTFLAG,DATELASTMAINT 
	FROM ONLINESUBTRANSHIST
   <![CDATA[
  	where cleardate < #clearDate#
  	]]>
	</insert>
    <update id="updateSubHistTransStep" parameterClass="java.util.HashMap">
    update onlinesubtranshist
    set procstep = #procStep#
    where subtransseqnbr
    in (
		select subtransseqnbr    
		from batchmertrans
		where mernbr = #merNbr# and departmentnbr=#departmentNbr# and standbooktypcd = #standbooktypCD#
    )
    </update>
</sqlMap>