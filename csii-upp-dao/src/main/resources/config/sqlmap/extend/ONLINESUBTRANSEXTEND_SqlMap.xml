<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ONLINESUBTRANSEXTEND">
<insert id="insertOnlinesubtransToHist" parameterClass="java.util.HashMap">
	insert into ONLINESUBTRANSHIST (SUBTRANSSEQNBR, TRANSSEQNBR, DOWNSYSSEQNBR, CLEARDATE,
  MERTRANSDATE, MERTRANSDATETIME, ORIGSUBMERSEQNBR, ORIGSUBMERTRANSDATE,
  ORIGSUBTRANSSEQNBR, ORIGCLEARDATE, TRANSCODE, MERNBR, MEROPENDEPTNBR,
  MERDEVDEPTNBR, PAYERACCTKIND, PAYEEACCTKIND, PAYERCARDTYPCD,
  PAYEECARDTYPCD, CUSTCIFNBR, PAYERACCTNBR, PAYERACCTTYPCD, PAYERACCTDEPTNBR,
  PAYERACCTNAME, PAYEEACCTNBR, PAYEEACCTDEPTNBR, PAYEEACCTTYPCD,
  PAYEEACCTNAME, TRANSAMT, CURRENCYCD, REFUNDEDAMT, UNREFUNDAMT,
  TRANSAMT1, TRANSAMT2, FEEAMT, TRANSSTATUS, PROCSTEP, PROCSTATUS,
  MEMO1, TRANSTIME, MEMO2, DEPARTMENTNBR, SYSTEMCODE, TRANSMODE,
  TRANSTYPCD, PROFITSEQNBR, CONFIRMEDPAYAMT, CONFIRMEDPAYDATE,
  CONFIRMEDCLEARDATE, CONFIRMEDMERSEQNBR, CONFIRMEDMERDATETIME,
  REFUNDMODE, MERSEQNBR, TRANSDATE, PAYTYPCD, FEENBR, SUPFEENBR,
  ELECPORTFLAG,DATELASTMAINT, CLIENTNO, BRANCHNO, INTERALFLAG, DEDUCTAMT, REALAMT, POINTREACCTDEPTNBR,REFUNDDEDUCTAMT,UNREFUNDDEDUCTAMT, 
  RECEIPTAMT, CODETYPCD, SCANCODEMODE, THIRDMERNBR, WECHATPROXYMERNBR, DISCOUNTABLEAMT, UNDISCOUNTABLEAMT)
	select SUBTRANSSEQNBR, TRANSSEQNBR, DOWNSYSSEQNBR, CLEARDATE,
  MERTRANSDATE, MERTRANSDATETIME, ORIGSUBMERSEQNBR, ORIGSUBMERTRANSDATE,
  ORIGSUBTRANSSEQNBR, ORIGCLEARDATE, TRANSCODE, MERNBR, MEROPENDEPTNBR,
  MERDEVDEPTNBR, PAYERACCTKIND, PAYEEACCTKIND, PAYERCARDTYPCD,
  PAYEECARDTYPCD, CUSTCIFNBR, PAYERACCTNBR, PAYERACCTTYPCD, PAYERACCTDEPTNBR,
  PAYERACCTNAME, PAYEEACCTNBR, PAYEEACCTDEPTNBR, PAYEEACCTTYPCD,
  PAYEEACCTNAME, TRANSAMT, CURRENCYCD, REFUNDEDAMT, UNREFUNDAMT,
  TRANSAMT1, TRANSAMT2, FEEAMT, TRANSSTATUS, PROCSTEP, PROCSTATUS,
  MEMO1, TRANSTIME, MEMO2, DEPARTMENTNBR, SYSTEMCODE, TRANSMODE,
  TRANSTYPCD, PROFITSEQNBR, CONFIRMEDPAYAMT, CONFIRMEDPAYDATE,
  CONFIRMEDCLEARDATE, CONFIRMEDMERSEQNBR, CONFIRMEDMERDATETIME,
  REFUNDMODE, MERSEQNBR, TRANSDATE, PAYTYPCD, FEENBR, SUPFEENBR,
  ELECPORTFLAG,DATELASTMAINT, CLIENTNO, BRANCHNO, INTERALFLAG, DEDUCTAMT, REALAMT, POINTREACCTDEPTNBR,REFUNDDEDUCTAMT,UNREFUNDDEDUCTAMT, 
  RECEIPTAMT, CODETYPCD, SCANCODEMODE, THIRDMERNBR, WECHATPROXYMERNBR, DISCOUNTABLEAMT, UNDISCOUNTABLEAMT
	from ONLINESUBTRANS
	where procstep = #procStep#
</insert>
<insert id="insertOlinesubtransToBatchClearSubTrans" parameterClass="java.util.HashMap">
	insert into BATCHCLEARSUBTRANS (
	SUBTRANSSEQNBR, TRANSSEQNBR, DOWNSYSSEQNBR, CLEARDATE,
  TRANSDATE, MERTRANSDATE, MERTRANSDATETIME, ORIGSUBMERSEQNBR,
  ORIGSUBMERTRANSDATE, ORIGSUBTRANSSEQNBR, ORIGCLEARDATE, TRANSCODE,
  MERNBR, MEROPENDEPTNBR, MERDEVDEPTNBR, PAYERACCTKIND, PAYEEACCTKIND,
  PAYERCARDTYPCD, PAYEECARDTYPCD, CUSTCIFNBR, PAYERACCTNBR, PAYERACCTTYPCD,
  PAYERACCTDEPTNBR, PAYERACCTNAME, PAYEEACCTNBR, PAYEEACCTDEPTNBR,
  PAYEEACCTTYPCD, PAYEEACCTNAME, TRANSAMT, CURRENCYCD, REFUNDEDAMT,
  UNREFUNDAMT, TRANSAMT1, TRANSAMT2, FEEAMT, TRANSSTATUS, PROCSTEP,
  PROCSTATUS, MEMO1, TRANSTIME, MEMO2, DEPARTMENTNBR, SYSTEMCODE,
  TRANSMODE, TRANSTYPCD, PROFITSEQNBR, CONFIRMEDPAYAMT, CONFIRMEDPAYDATE,
  CONFIRMEDCLEARDATE, CONFIRMEDMERSEQNBR, CONFIRMEDMERDATETIME,
  REFUNDMODE, PAYTYPCD, MERSEQNBR, FEENBR, SUPFEENBR, ELECPORTFLAG,DATELASTMAINT, 
  CLIENTNO, BRANCHNO, INTERALFLAG, DEDUCTAMT, REALAMT, POINTREACCTDEPTNBR,REFUNDDEDUCTAMT,UNREFUNDDEDUCTAMT, 
  RECEIPTAMT, CODETYPCD, SCANCODEMODE, THIRDMERNBR, WECHATPROXYMERNBR, DISCOUNTABLEAMT, UNDISCOUNTABLEAMT)
	select SUBTRANSSEQNBR, TRANSSEQNBR, DOWNSYSSEQNBR, CLEARDATE,
  TRANSDATE, MERTRANSDATE, MERTRANSDATETIME, ORIGSUBMERSEQNBR,
  ORIGSUBMERTRANSDATE, ORIGSUBTRANSSEQNBR, ORIGCLEARDATE, TRANSCODE,
  MERNBR, MEROPENDEPTNBR, MERDEVDEPTNBR, PAYERACCTKIND, PAYEEACCTKIND,
  PAYERCARDTYPCD, PAYEECARDTYPCD, CUSTCIFNBR, PAYERACCTNBR, PAYERACCTTYPCD,
  PAYERACCTDEPTNBR, PAYERACCTNAME, PAYEEACCTNBR, PAYEEACCTDEPTNBR,
  PAYEEACCTTYPCD, PAYEEACCTNAME, TRANSAMT, CURRENCYCD, REFUNDEDAMT,
  UNREFUNDAMT, TRANSAMT1, TRANSAMT2, FEEAMT, TRANSSTATUS, PROCSTEP,
  PROCSTATUS, MEMO1, TRANSTIME, MEMO2, DEPARTMENTNBR, SYSTEMCODE,
  TRANSMODE, TRANSTYPCD, PROFITSEQNBR, CONFIRMEDPAYAMT, CONFIRMEDPAYDATE,
  CONFIRMEDCLEARDATE, CONFIRMEDMERSEQNBR, CONFIRMEDMERDATETIME,
  REFUNDMODE, PAYTYPCD, MERSEQNBR, FEENBR, SUPFEENBR, ELECPORTFLAG,DATELASTMAINT,
  CLIENTNO, BRANCHNO, INTERALFLAG, DEDUCTAMT, REALAMT, POINTREACCTDEPTNBR,REFUNDDEDUCTAMT,UNREFUNDDEDUCTAMT, 
  RECEIPTAMT, CODETYPCD, SCANCODEMODE, THIRDMERNBR, WECHATPROXYMERNBR, DISCOUNTABLEAMT, UNDISCOUNTABLEAMT
	from ONLINESUBTRANS
	where procstep = #procStep#
</insert>

	<!-- 更新子交易表对账状态，用于提取对账数据 added by wangtao 20161229 -->
	<update id="updateOnlineSubtransForCheck"  parameterClass="java.util.HashMap">
		UPDATE
		ONLINESUBTRANS
		SET
		PROCSTEP=#procStep#
		WHERE
		TRANSSTATUS !=#transStatus#
		AND
		DEPARTMENTNBR=#departmentNbr#
		AND
		TRANSSEQNBR = #transSeqNbr#
	</update>	
</sqlMap>